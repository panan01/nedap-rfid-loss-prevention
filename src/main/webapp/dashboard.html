<!DOCTYPE html>
<html class="app-html" lang="en" xmlns="http://www.w3.org/1999/html">
    <head>
        <meta charset="utf-8">
        <link rel="stylesheet" href="font/fonts.css">
        <link rel="stylesheet" href="css/main.css">
        <link href="https://fonts.googleapis.com/css2?family=Material+Icons+Outlined" rel="stylesheet">
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
            integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
            crossorigin=""/>
        <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

        <script src="js/jquery.js"></script>
        <script src="js/commandbar.js"></script>
        <script src="js/app.js"></script>
        <script src="js/chart.js"></script>
        <script src="js/sorttable.js"></script>
        <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
            integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
            crossorigin=""></script>

        <title>Dashboard</title>

        <style>
            .logo::before {
                display: block;
                width: 100%;
                height: 100%;
                background-image: url("svg/nedap_inline_logo_on_blue.svg");
                background-position: center;
                background-size: contain;
                background-repeat: no-repeat;
                content: "";
                box-sizing: border-box;
                border: 10px solid transparent;
            }
            #navbarLinks {
                display: none;
                min-width: 0;
                text-align: center;
                vertical-align: middle;
                background-color: #023A4F;

            }
            #navbarLinks a {
                text-decoration: none;
                -webkit-user-select: none;
                -ms-user-select: none;
                user-select: none;
                display: table-cell;
                position: relative;
                vertical-align: middle;
                font-size: 20px;
                background-color: #023A4F;
                color: white;
            }
            #navbarLinks a:hover {
                background-color: #01151d;
            }
            #icon {
                position: relative;
                float: right;
                color: white;
                background-color: #FF6C37;
            }
            #icon:hover {
                background-color: #FF4710;
            }
            #icon div {
                text-align: center;
            }
            #icon div span {
                font-size: 48px;
                -webkit-user-select: none;
                -ms-user-select: none;
                user-select: none;
            }
        </style>

        <script src="js/dashboard.js"></script>
    </head>

    <body class="app">
        <div class="app-bar">
            <div class="app-bar-inner" style="display: inline-flex">
                <div class="logo"> </div>
                <input class="searchbar" id="searchbar" type="text" placeholder="Type here to search">
                <a onclick="navbarMenu()" id="icon">
                    <div class="profile-icon">
                        <span class="icon">account_circle</span>
                    </div>
                </a>
                <div id="navbarLinks">
                    <a onclick="logOut()">Log out</a>
                </div>
            </div>
        </div>

        <div class="app-nav" id="nav">
            <a href="./dashboard.html"><div class="nav-entry nav-current" -icon="dashboard" -name="Dashboard"></div></a>
            <a href="./account.html"><div class="nav-entry" -icon="account_circle" -name="Account"></div></a>
            <a href="./data_reports.html"><div class="nav-entry" -icon="file_upload" -name="Data"></div></a>
            <a href="./admin_overview.html"><div class="nav-entry" -icon="admin_panel_settings" -name="Admin"></div></a>
        </div>

        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                <h1 class="h2">Dashboard</h1>
            </div>

        </main>
        <!-- OVERALL INFORMATION CARDS -->
        <div class="app-content" id="app">
            <div class="flex vertical-700">
                <div class="flex">
                    <div class="card">
                        <div class="card-header">Overall store performance</div>
                        <div class="card-content">
                            The following cards display useful information about stores and their overall loss prevention performances in a quick overview.
                        </div>
                    </div>
                </div>
            </div>
            <!-- RED ORANGE GREEN NUMBER OF THEFTS CARDS -->
            <div class="flex vertical-700">
                <div class="card card-error">
                    <div class="card-header">Most amount of thefts</div>
                    <div class="card-content">
                        <script>
                            window.addEventListener("load", function(){
                                $.ajax({
                                    url: "rest/app",
                                    method: 'POST',
                                    dataType: 'json',
                                    data: "SELECT array_to_json(array_agg(t)) FROM ( ? ) AS t;1-1|alarm.store_id|-2|alarm:article|-1|article.id:=:alarm.article_id|-1|alarm.store_id|-0-1|alarm.store_id|-1|1|",
                                    success: function(response) {
                                        let array = [[ 'StoreID', 'theftAmount'
                                        ]];
                                        for (let item of response){
                                            array.push([item.store_id.toString(), item.count]);
                                        }
                                        document.getElementById("storeID_MOST").innerHTML = array[1][0];
                                        document.getElementById("theftAmount_MOST").innerHTML = array[1][1];
                                    }
                                })
                            });
                            window.addEventListener("load", function(){
                                $.ajax({
                                    url: "rest/app",
                                    method: 'POST',
                                    dataType: 'json',
                                    data: "SELECT array_to_json(array_agg(t)) FROM ( ? ) AS t;4-7-0-0-0-0-0-0",
                                    success: function(response) {
                                        let array = [[ 'StoreID', 'theftAmount'
                                        ]];
                                        var sumLosses = 0;
                                        for (let item of response){
                                            array.push([item.product.toString(), item.count, item.price]);
                                            sumLosses += item.count * item.price;
                                        }

                                        var averageLoss = sumLosses / 1948;

                                        document.getElementById("sumLosses").innerHTML = sumLosses.toFixed(2);
                                        document.getElementById("averageLoss").innerHTML = averageLoss.toFixed(2);
                                    }
                                })
                            });
                        </script>
                        Store <b><span id="storeID_MOST"></span></b> has <b><span id="theftAmount_MOST"></span></b> stolen items.<br>
                        The average is <b><span id="theftAmount_AVERAGE_MOST"></span></b> stolen items per store.<br>
                    </div>
                </div>
                <div class="card card-warning">
                    <div class="card-header">Increasing amount of thefts</div>
                    <div class="card-content">
                        <script>
                            window.addEventListener("load", function(){
                                $.ajax({
                                    url: "rest/app",
                                    method: 'POST',
                                    dataType: 'json',
                                    data: "SELECT array_to_json(array_agg(t)) FROM ( ? ) AS t;2-7-0-0-0-0-0-0",
                                    success: function(response) {
                                        let array = [[ 'StoreID', 'janAmount', 'febAmount', 'marAmount', 'differenceFebMar']];
                                        for (let item of response) {
                                            var differenceFebMar = (item.mar_amount-item.feb_amount)/item.feb_amount*100
                                            array.push([item.id.toString(), item.jan_amount, item.feb_amount, item.mar_amount, differenceFebMar]);
                                        }

                                        var maxDifference = 0
                                        var minDifference = 0
                                        var storeInDanger = null;
                                        var storeNotInDanger = null;

                                        var maxItemsStolenBegin = 0;
                                        var maxItemsStolenEnd = 0;
                                        var minItemsStolenBegin = 0;
                                        var minItemsStolenEnd = 0;

                                        for (var i = 1; i < array.length; i++) {
                                            if(isNaN(array[i][4])) {
                                                array[i][4]=0;
                                            }
                                            if (array[i][4] > maxDifference) {
                                                maxDifference = array[i][4]
                                                storeInDanger = array[i][0]
                                                maxItemsStolenBegin = array[i][2]
                                                maxItemsStolenEnd = array[i][3]
                                            } else if (array[i][4] < minDifference) {
                                                minDifference = array[i][4]
                                                storeNotInDanger = array[i][0]
                                                minItemsStolenBegin = array[i][2]
                                                minItemsStolenEnd = array[i][3]
                                            }
                                        }
                                        document.getElementById("maxDifference").innerHTML = maxDifference.toFixed(2);
                                        document.getElementById("storeInDanger").innerHTML = storeInDanger;
                                        document.getElementById("minDifference").innerHTML = minDifference.toFixed(2);
                                        document.getElementById("storeNotInDanger").innerHTML = storeNotInDanger;

                                        document.getElementById("maxItemsStolenBegin").innerHTML = maxItemsStolenBegin;
                                        document.getElementById("maxItemsStolenEnd").innerHTML = maxItemsStolenEnd;
                                        document.getElementById("minItemsStolenBegin").innerHTML = minItemsStolenBegin;
                                        document.getElementById("minItemsStolenEnd").innerHTML = minItemsStolenEnd;

                                        var overallDifferenceSum = 0;

                                        for (var j = 1; j < array.length; j++) {
                                            overallDifferenceSum += array[j][4]
                                        }

                                        var overallDifferenceAverage = overallDifferenceSum / 53
                                        document.getElementById("overallDifferenceAverage").innerHTML = overallDifferenceAverage.toFixed(2);
                                    }
                                })
                            });
                        </script>
                           In <b>March</b>, there was an average <b>increase</b> of <b><span id="overallDifferenceAverage"></span>%</b> thefts in <b>all</b> stores.
                    </div>
                </div>
                <div class="card card-success">
                    <div class="card-header">Lowest amount of thefts</div>
                    <div class="card-content">
                        <script>
                            window.addEventListener("load", function(){
                                $.ajax({
                                    url: "rest/app",
                                    method: 'POST',
                                    dataType: 'json',
                                    data: "SELECT array_to_json(array_agg(t)) FROM ( ? ) AS t;1-1|alarm.store_id|-2|alarm:article|-1|article.id:=:alarm.article_id|-1|alarm.store_id|-0-3|alarm.store_id|-1|1|",
                                    success: function(response) {
                                        let array = [[ 'StoreID', 'theftAmount'
                                        ]];
                                        for (let item of response){
                                            array.push([item.store_id.toString(), item.count]);
                                        }
                                        document.getElementById("storeID_LOWEST").innerHTML = array[1][0];
                                        document.getElementById("theftAmount_LOWEST").innerHTML = array[1][1];
                                    }
                                })
                            });
                        </script>
                        <script>
                            window.addEventListener("load", function(){
                                $.ajax({
                                    url: "rest/app",
                                    method: 'POST',
                                    dataType: 'json',
                                    data: "SELECT array_to_json(array_agg(t)) FROM ( ? ) AS t;1-1|alarm.store_id|-2|alarm:article|-1|article.id:=:alarm.article_id|-1|alarm.store_id|-0-1|alarm.store_id|-0",
                                    success: function(response) {
                                        let array = [[ 'StoreID', 'theftAmount'
                                        ]];
                                        var theftSum = 0;
                                        for (let item of response){
                                            array.push([item.store_id.toString(), item.count]);
                                            theftSum += item.count;
                                        }
                                        var average = (theftSum / 53).toFixed(0);
                                        document.getElementById("theftAmount_AVERAGE_MOST").innerHTML = average;
                                        document.getElementById("theftAmount_AVERAGE_LOWEST").innerHTML = average;
                                    }
                                })
                            });
                        </script>
                        Store <b><span id="storeID_LOWEST"></span></b> has <b><span id="theftAmount_LOWEST"></span></b> stolen items.<br>
                        The average is <b><span id="theftAmount_AVERAGE_LOWEST"></span></b> stolen items per store.<br>
                    </div>
                </div>
            </div>
            <!-- SMALL CARDS AMOUNT OF THEFTS STORE -->
            <div class="flex vertical-700" style="margin-top: -13px">
                <div class="card card-error">
                    <div class="card-content">
                        This results in a total loss of <b>€ <span id="sumLosses"></span></b>, with an average of <b>€ <span id="averageLoss"></span></b> per item.
                    </div>
                </div>
                <div class="card card-warning">
                    <div class="card-content">
                        In <b>March</b>, there was an <b>increase</b> of <b><span id="maxDifference"></span>%</b> thefts in store <b><span id="storeInDanger"></span></b>
                        <br>The thefts increased from <b><span id="maxItemsStolenBegin"></span></b> to <b><span id="maxItemsStolenEnd"></span></b>.
                    </div>
                </div>
                <div class="card card-success">
                    <div class="card-content">
                        In <b>March</b>, there was a <b>decrease</b> of <b><span id="minDifference"></span>%</b> thefts in store <b><span id="storeNotInDanger"></span></b>.
                        <br>The thefts decreased from <b><span id="minItemsStolenBegin"></span></b> to <b><span id="minItemsStolenEnd"></span></b>.
                    </div>
                </div>
            </div>
            <!-- RED ORANGE GREEN NUMBER OF CATEGORIES THEFTS -->
            <div class="flex vertical-700">
                <div class="card card-error">
                    <div class="card-header">Most thefts in category</div>
                    <div class="card-content">
                        <script>
                            window.addEventListener("load", function(){
                                $.ajax({
                                    url: "rest/app",
                                    method: 'POST',
                                    dataType: 'json',
                                    data: "SELECT array_to_json(array_agg(t)) FROM ( ? ) AS t;1-1|article.category|-1|article|-0-1|article.category|-0-1|article.category|-0",
                                    success: function(response) {
                                        let array = [[ 'Category', 'categoryTheft'
                                        ]];
                                        var categoryTheftSum = 0;
                                        for (let item of response){
                                            array.push([item.category.toString(), item.count]);
                                            categoryTheftSum += item.count;
                                        }
                                        document.getElementById("category_MOST").innerHTML = array[1][0];
                                        document.getElementById("categoryTheft_MOST").innerHTML = array[1][1];
                                        var categoryAverage = (categoryTheftSum / 64).toFixed(0)
                                        document.getElementById("categoryAverage_MOST").innerHTML = categoryAverage;
                                        document.getElementById("categoryAverage_LOWEST").innerHTML = categoryAverage;
                                    }
                                })
                            });
                        </script>
                        Category <b><span id="category_MOST"></span></b> has <b><span id="categoryTheft_MOST"></span></b> stolen items.<br>
                        The average is <b><span id="categoryAverage_MOST"></span></b> stolen items per store.
                    </div>
                </div>
                <div class="card card-warning">
                    <div class="card-header">Increasing thefts in category</div>
                    <div class="card-content">
                        <script>
                            window.addEventListener("load", function(){
                                $.ajax({
                                    url: "rest/app",
                                    method: 'POST',
                                    dataType: 'json',
                                    data: "SELECT array_to_json(array_agg(t)) FROM ( ? ) AS t;3-7-0-0-0-0-0-0",
                                    success: function(response) {
                                        let array = [[ 'Category', 'janAmount', 'febAmount', 'marAmount', 'differenceFebMar']];
                                        for (let item of response) {
                                            var differenceFebMar = (item.feb_amount-item.jan_amount)/item.jan_amount*100
                                            array.push([item.category.toString(), item.jan_amount, item.feb_amount, item.mar_amount, differenceFebMar]);
                                        }
                                        var maxDifference = 0
                                        var minDifference = 0
                                        var categoryInDanger = null;
                                        var categoryNotInDanger = null;

                                        var maxItemsStolenBegin = 0;
                                        var maxItemsStolenEnd = 0;
                                        var minItemsStolenBegin = 0;
                                        var minItemsStolenEnd = 0;

                                        for (var i = 1; i < array.length; i++) {
                                            if(!isFinite(array[i][4]) || isNaN(array[i][4])) {
                                                array[i][4]=0;
                                            }
                                            if (array[i][4] > maxDifference) {
                                                maxDifference = array[i][4]
                                                categoryInDanger = array[i][0]
                                                maxItemsStolenBegin = array[i][1]
                                                maxItemsStolenEnd = array[i][2]
                                            } else if (array[i][4] < minDifference) {
                                                minDifference = array[i][4]
                                                categoryNotInDanger = array[i][0]
                                                minItemsStolenBegin = array[i][1]
                                                minItemsStolenEnd = array[i][2]
                                            }
                                        }
                                        document.getElementById("maxDifferenceCategory").innerHTML = maxDifference.toFixed(2);
                                        document.getElementById("categoryInDangerCategory").innerHTML = categoryInDanger;
                                        document.getElementById("minDifferenceCategory").innerHTML = minDifference.toFixed(2);
                                        document.getElementById("categoryNotInDangerCategory").innerHTML = categoryNotInDanger;

                                        document.getElementById("maxItemsStolenBeginCategory").innerHTML = maxItemsStolenBegin;
                                        document.getElementById("maxItemsStolenEndCategory").innerHTML = maxItemsStolenEnd;
                                        document.getElementById("minItemsStolenBeginCategory").innerHTML = minItemsStolenBegin;
                                        document.getElementById("minItemsStolenEndCategory").innerHTML = minItemsStolenEnd;

                                        var overallDifferenceSum = 0;

                                        for (var k = 1; k < array.length; k++) {
                                            overallDifferenceSum += array[k][4]
                                        }

                                        var overallDifferenceAverageCategory = overallDifferenceSum / 53
                                        document.getElementById("overallDifferenceAverageCategory").innerHTML = overallDifferenceAverageCategory.toFixed(2);
                                    }
                                })
                            });
                        </script>
                        In <b>February</b>, there was an average <b>decrease</b> of <b><span id="overallDifferenceAverageCategory"></span>%</b> thefts in <b>all</b> stores.
                    </div>
                </div>
                <div class="card card-success">
                    <div class="card-header">Lowest thefts in category</div>
                    <div class="card-content">
                        <script>
                            window.addEventListener("load", function(){
                                $.ajax({
                                    url: "rest/app",
                                    method: 'POST',
                                    dataType: 'json',
                                    data: "SELECT array_to_json(array_agg(t)) FROM ( ? ) AS t;1-1|article.category|-1|article|-0-1|article.category|-0-3|article.category|-1|1|",
                                    success: function(response) {
                                        let array = [[ 'StoreID', 'theftAmount'
                                        ]];
                                        for (let item of response) {
                                            array.push([item.category.toString(), item.count]);
                                        }

                                        document.getElementById("category_LOWEST").innerHTML = array[1][0];
                                        document.getElementById("categoryTheft_LOWEST").innerHTML = array[1][1];
                                    }
                                })
                            });
                        </script>
                        Category <b><span id="category_LOWEST"></span></b> has <b><span id="categoryTheft_LOWEST"></span></b> stolen item.<br>
                        The average is <b><span id="categoryAverage_LOWEST"></span></b> stolen items per category.<br>
                    </div>
                </div>
            </div>
            <!-- SMALL CARDS AMOUNT OF THEFTS CATEGORY -->
            <div class="flex vertical-700" style="margin-top: -13px">
                <div class="card card-error">
                    <div class="card-content">
                        <script>
                            window.addEventListener("load", function(){
                                $.ajax({
                                    url: "rest/app",
                                    method: 'POST',
                                    dataType: 'json',
                                    data: "SELECT array_to_json(array_agg(t)) FROM ( ? ) AS t;5-7-0-0-0-0-0-0",
                                    success: function(response) {
                                        let array = [[ 'AveragePriceCategoryOne' ]];
                                        for (let item of response) {
                                            array.push([item.avg]);
                                        }
                                        var totalLossesCategory = 1410 * array[1][0]

                                        document.getElementById("AveragePriceCategoryOne").innerHTML = array[1][0].toFixed(2);
                                        document.getElementById("totalLossesCategory").innerHTML = totalLossesCategory.toFixed(2);
                                    }
                                })
                            });
                        </script>
                        This results in a total loss of <b>€ <span id="totalLossesCategory"></span></b>, with an average of <b>€ <span id="AveragePriceCategoryOne"></span></b> per item.
                    </div>
                </div>
                <div class="card card-warning">
                    <div class="card-content">
                        In <b>February</b>, there was an <b>increase</b> of <b><span id="maxDifferenceCategory"></span>%</b> thefts in category <b><span id="categoryInDangerCategory"></span></b>.
                        <br>The thefts increased from <b><span id="maxItemsStolenBeginCategory"></span></b> to <b><span id="maxItemsStolenEndCategory"></span></b>.
                    </div>
                </div>
                <div class="card card-success">
                    <div class="card-content">
                        In <b>February</b>, there was a <b>decrease</b> of <b><span id="minDifferenceCategory"></span>%</b> thefts in category <b><span id="categoryNotInDangerCategory"></span></b>.
                        <br>The thefts decreased from <b><span id="minItemsStolenBeginCategory"></span></b> to <b><span id="minItemsStolenEndCategory"></span></b>.
                    </div>
                </div>
            </div>

            <!-- GRAPHS EXPLANATION CARD -->
            <div class="flex vertical-700">
                <div class="flex">
                    <div class="card">
                        <div class="card-header">Graphs</div>
                        <div class="card-content">
                            The following graphs display detailed and useful information about stores and their overall loss prevention performances. Graphs can be used for deeper analysis and better understanding of stores' performances.
                        </div>
                    </div>
                </div>
            </div>
            <!-- DASHBOARD GRAPHS -->
            <div class="flex vertical-700">
                <!-- CHART -->
                <div class="flex vertical">
                    <div class="card">
                        <div class="card-image" id="chart-canvas-pie-1" style="height: 400px; overflow-x: hidden"></div>
                            <script>
                                window.addEventListener("load", function() {
                                    $.ajax({
                                        url: "rest/app",
                                        method: 'POST',
                                        dataType: 'json',
                                        data: "SELECT array_to_json(array_agg(t)) FROM ( ? ) AS t;1-1|article.product|-1|article|-0-1|article.product|-0-1|article.product|-1|10|",
                                        success: function (response) {
                                            let array = [[
                                                'Product', 'Amount',
                                            ]];
                                            for (let item of response) {
                                                array.push([item.product.toString(), item.count]);
                                            }

                                            let data = google.visualization.arrayToDataTable(array)

                                            var options = {
                                                backgroundColor: {
                                                    fill: '#F4F4F4'
                                                },
                                                colors: ['#163C4C', '#1B4C5F', '#215B72', '#276A85', '#2C7998', '#468AA5', '#619BB2', '#7BABBF', '#95BCCC', '#B0CDD8'],
                                                chartArea: {
                                                    top: 20,
                                                    left: 110,
                                                    bottom: 30,
                                                    width: '100%'
                                                },
                                                width: '100%',
                                                legend: {
                                                    alignment: 'center',
                                                    position: 'right',
                                                }

                                            };

                                            var chart = new google.visualization.PieChart(document.getElementById('chart-canvas-pie-1'));

                                            chart.draw(data, options);
                                        }
                                    })
                                })
                            </script>
                        <div class="card-header" style="padding-top: 10px">
                            Top 10 most stolen items
                        </div>
                        <div class="card-content">
                            An overview of all items ever stolen.
                        </div>
                    </div>
                </div>

                <!-- CHART -->
                <div class="flex vertical">
                    <div class="card">
                        <div class="card-image" id="chart-canvas-1" style="height: 400px">
                        </div>
                        <script>
                            window.addEventListener("load", function(){
                                $.ajax({
                                    url: "rest/app",
                                    method: 'POST',
                                    dataType: 'json',
                                    data: "SELECT array_to_json(array_agg(t)) FROM ( ? ) AS t;1-1|article.category|-1|article|-0-1|article.category|-0-1|article.category|-0",
                                    success: function(response) {
                                        let array = [[
                                            'Category', 'Amount',
                                        ]];
                                        for (let item of response){
                                            array.push([item.category.toString(), item.count]);
                                        }
                                        let data = google.visualization.arrayToDataTable(array);
                                        let options = {
                                            backgroundColor: {
                                                fill: '#F4F4F4'
                                            },
                                            colors: ['#2C7998'],
                                            chartArea: {
                                                top: 20,
                                                left: 50,
                                                bottom: 50,
                                                width: '100%'
                                            },
                                            height: 375,
                                            width: 1200,
                                            hAxis: {
                                                gridlines: {
                                                    count: 0
                                                },
                                                viewWindow: {
                                                    min: 0,
                                                    max: 65
                                                },
                                                slantedText: true,
                                                slantedTextAngle: 90,
                                                showTextEvery: 1,
                                                title: 'Category Number',
                                            },
                                            vAxis: {
                                                viewWindow: {
                                                    max: 1600
                                                }
                                            },
                                            legend: {
                                                position: 'in',
                                                alignment: 'end'
                                            }
                                        };
                                        let chart = new google.visualization.ColumnChart(document.getElementById('chart-canvas-1'));

                                        chart.draw(data, options);
                                    }
                                });

                            });
                        </script>
                        <div class="card-header" style="padding-top: 10px">Stolen items per category</div>
                        <div class="card-content">
                            An overview of all items ever stolen per category.
                        </div>
                    </div>
                </div>
            </div>
            <div class="flex vertical-800">
                <div class="flex vertical">
                    <div class="card">
                        <div class="card-image" id="chart-canvas-2" style="height: 400px">
                        </div>
                        <script>
                            window.addEventListener("load", function(){
                                $.ajax({
                                    url: "rest/app",
                                    method: 'POST',
                                    dataType: 'json',
                                    data: "SELECT array_to_json(array_agg(t)) FROM ( ? ) AS t;1-1|article.price|-1|article|-0-1|article.price|-0-1|article.price|-0",
                                    success: function(response) {
                                        let array = [[
                                            {label: 'Price', type: 'number'},
                                            {label: 'Amount', type: 'number'},
                                        ]];
                                        for (let item of response){
                                            if (item.count > 50 && item.price > 0) {
                                                array.push([Math.round(item.price), item.count]);
                                            }
                                        }
                                        let data = google.visualization.arrayToDataTable(array);
                                        let formatter = new google.visualization.NumberFormat({prefix: '€'});
                                        formatter.format(data, 0);
                                        let options = {
                                            backgroundColor: {
                                                fill: '#F4F4F4'
                                            },
                                            colors: ['#2C7998'],
                                            chartArea: {
                                                top: 20,
                                                left: 50,
                                                bottom: 50,
                                                height: '100%',
                                                width: '100%'
                                            },
                                            height: 375,
                                            width: 1000,
                                            hAxis: {
                                                gridlines: {
                                                    count: 0
                                                },
                                                title: 'Price in €',
                                            },
                                            legend: {
                                                position: 'in',
                                                alignment: 'end'
                                            },
                                            bar: {
                                                groupWidth: 10
                                            },
                                        };
                                        let chart = new google.visualization.ColumnChart(document.getElementById('chart-canvas-2'));

                                        chart.draw(data, options);
                                    }
                                });

                            });
                        </script>
                        <div class="card-header" style="padding-top: 10px">Stolen items at price</div>
                        <div class="card-content">
                            An overview of all things stolen at a set price.
                        </div>
                    </div>
                </div>
                <div class="flex vertical">
                    <div class="card">
                        <div class="card-image" id="chart-canvas-3" style="height: 400px">
                        </div>
                        <script>
                            window.addEventListener("load", function(){
                                $.ajax({
                                    url: "rest/app",
                                    method: 'POST',
                                    dataType: 'json',
                                    data: "SELECT array_to_json(array_agg(t)) FROM ( ? ) AS t;1-1|alarm.store_id|-2|alarm:article|-1|article.id:=:alarm.article_id|-1|alarm.store_id|-0-1|alarm.store_id|-0",
                                    success: function(response) {
                                        let array = [[
                                            'Store', 'Amount',
                                        ]];
                                        for (let item of response){
                                            array.push([item.store_id.toString(), item.count]);
                                        }
                                        let data = google.visualization.arrayToDataTable(array);
                                        let options = {
                                            backgroundColor: {
                                                fill: '#F4F4F4'
                                            },
                                            colors: ['#2C7998'],
                                            chartArea: {
                                                top: 20,
                                                left: 50,
                                                bottom: 80,
                                                height: '50%',
                                                width: '100%'
                                            },
                                            height: 365,
                                            width: 1200,
                                            hAxis: {
                                                title: 'Store ID',
                                                slantedText: true,
                                                slantedTextAngle: 90,
                                                showTextEvery: 1,
                                            },
                                            bar: {
                                                groupWidth: 10
                                            },
                                            legend: {
                                                position: 'in',
                                                alignment: 'end'
                                            },
                                        };
                                        let chart = new google.visualization.ColumnChart(document.getElementById('chart-canvas-3'));

                                        chart.draw(data, options);
                                    }
                                });

                            });
                        </script>
                        <div class="card-header" style="padding-top: 10px">Stolen items at each store</div>
                        <div class="card-content">
                            An overview of all items ever stolen for each store.
                        </div>
                    </div>
                </div>
            </div>
            <div class="flex vertical-700">
                <div class="flex vertical grow-2">
                    <div class="card">
                        <div class="card-image" id="chart-canvas-timestamps" style="height: 400px; width: 720px; overflow-x: hidden; margin-bottom: -10px">
                            <div id="weekDays" style="padding-bottom: 10px">
                                <script>
                                    window.addEventListener("load", function(){
                                        $.ajax({
                                            url: "rest/app",
                                            method: 'POST',
                                            dataType: 'json',
                                            data: "SELECT array_to_json(array_agg(t)) FROM ( ? ) AS t;6-7-0-0-0-0-0-0",
                                            success: function(response) {
                                                let array = [[
                                                    'Weekday', 'Count',
                                                ]];
                                                for (let item of response){
                                                    array.push([item.weekday.toString(), item.count]);
                                                }

                                                var weekdayMost = null;
                                                var weekdayMostTotal = 0;
                                                for (var  m = 1; m < array.length; m++) {
                                                    if (array[m][1] > weekdayMostTotal) {
                                                        weekdayMostTotal = array[m][1]
                                                        weekdayMost = array[m][0]
                                                    }
                                                }
                                                weekdayMost = weekdayMost[0].toUpperCase() + weekdayMost.substring(1)
                                                document.getElementById("weekdayMost").innerHTML = weekdayMost

                                                // document.getElementById("weekdayMostTotal").innerHTML = weekdayMostTotal

                                                let data = google.visualization.arrayToDataTable(array);
                                                let options = {
                                                    backgroundColor: {
                                                        fill: '#F4F4F4'
                                                    },
                                                    colors: ['#2C7998'],
                                                    height: 365,
                                                    width: 700,
                                                    chartArea: {
                                                        top: 20,
                                                        left: 60,
                                                        bottom: 40,
                                                        height: '50%',
                                                        width: '90%'
                                                    },
                                                    hAxis: {
                                                        title: 'Weekday',
                                                        showTextEvery: 1,
                                                    },
                                                    bar: {
                                                        groupWidth: 40
                                                    },
                                                    legend: {
                                                        position: 'in',
                                                        alignment: 'end'
                                                    },
                                                };
                                                let chart = new google.visualization.ColumnChart(document.getElementById('weekDays'));

                                                chart.draw(data, options);
                                            }
                                        });
                                    });
                                </script>
                            </div>
                            <div id="hours">
                                <script>
                                    window.addEventListener("load", function(){
                                        $.ajax({
                                            url: "rest/app",
                                            method: 'POST',
                                            dataType: 'json',
                                            data: "SELECT array_to_json(array_agg(t)) FROM ( ? ) AS t;0-1|timeinterval|-5|'hour'|-0-1|timeinterval|-0-1|timeinterval|-0",
                                            success: function(response) {
                                                let array = [[
                                                    'Hour', 'Count',
                                                ]];
                                                for (let item of response){
                                                    array.push([item.timeinterval.toString(), item.count]);
                                                }

                                                var hourMost = null;
                                                var hourMostTotal = 0;
                                                for (var  m = 1; m < array.length; m++) {
                                                    if (array[m][1] > hourMostTotal) {
                                                        hourMostTotal = array[m][1]
                                                        hourMost = array[m][0]
                                                    }
                                                }
                                                document.getElementById("hourMost").innerHTML = hourMost
                                                // document.getElementById("hourMostTotal").innerHTML = hourMostTotal

                                                let data = google.visualization.arrayToDataTable(array);
                                                let options = {
                                                    backgroundColor: {
                                                        fill: '#F4F4F4'
                                                    },
                                                    colors: ['#2C7998'],
                                                    chartArea: {
                                                        top: 20,
                                                        left: 50,
                                                        bottom: 40,
                                                        height: '50%',
                                                        width: '90%'
                                                    },
                                                    height: 365,
                                                    width: 710,
                                                    hAxis: {
                                                        title: 'Hour',
                                                        showTextEvery: 1,
                                                    },
                                                    bar: {
                                                        groupWidth: 10
                                                    },
                                                    legend: {
                                                        position: 'in',
                                                        alignment: 'end'
                                                    },
                                                };
                                                let chart = new google.visualization.ColumnChart(document.getElementById('hours'));
                                                chart.draw(data, options);
                                            }
                                        });
                                    });
                                </script>
                            </div>
                        </div>
                        <div class="card-header" style="padding-top: 10px">Thefts per timeframe</div>
                        <div class="card-content">
                            An overview of all thefts per timeframe for all stores.
                        </div>
                        <script>
                            function changeTimeframe() {
                                var weekdayGraph = document.getElementById("weekDays")
                                var hourGraph = document.getElementById("hours")

                                if(weekdayGraph.style.display === "none") {
                                    weekdayGraph.style.display = "block";
                                    weekdayGraph.style.visibility = "visible";
                                    hourGraph.style.display = "none";
                                    hourGraph.style.display = "hidden";
                                } else {
                                    weekdayGraph.style.display = "none";
                                    weekdayGraph.style.visibility = "hidden";
                                    hourGraph.style.display = "block";
                                    hourGraph.style.display = "visible";
                                }
                            }
                        </script>
                    </div>
                </div>
                <div class="flex vertical">
                    <div class="card card-dark wrap">
                        <div class="card-header" style="text-align: center; padding-top: 60px">
                            Timeframes most <br> prone for theft
                        </div>
                        <div class="card-header" style="text-align: center">
                            Day:
                        </div>
                        <div class="card-content" style="text-align: center">
                            <span class="card-content" id="weekdayMost" style="color: whitesmoke; font-size: 17pt">day</span><br>
                        <div class="card-header" style="text-align: center">
                            Hour:
                        </div>
                        <div class="card-content" style="text-align: center">
                            <span class="card-content" id="hourMost" style="color: whitesmoke; font-size: 17pt">hour</span><br>
                        </div>
                        <div class="card-content" style="text-align: center; padding-top: 30px">
                            <button class="btn btn-alt btn-outline" onclick="app.showSnackbar({text: 'Timeframe changed', style: 'dark', buttons: [{text: 'Hide', handler: sb => sb.close()}]}); changeTimeframe()">Change timeframe</button>
                        </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- MAP -->
            <div class="card">
                <div id="mapid" style="height: 400px"></div>
                <script>
                   $.ajax({
                        url: "rest/app",
                        method: 'POST',
                        dataType: 'json',
                        data: "SELECT array_to_json(array_agg(t)) FROM ( ? ) AS t;1-2-1|store|-0-0-0-0-0",
                        success: function(locationResult) {
                            let array = [[
                                {label: 'Store ID', type: 'number'},
                                {label: 'Longitude', type: 'number'},
                                {label: 'Latitude', type: 'number'},
                            ]];
                            for (let item of locationResult){
                                array.push([item.store_id, item.longitude, item.latitude]);
                            }
                            var mapData = locationResult;

                            let grouped = {};

                            for (let d of mapData) {
                                if (d.latitude !== null && d.longitude !== null) {
                                    let key = d.latitude + ";" + d.longitude;

                                    let collection = grouped[key];
                                    if (!collection) {
                                        collection = {coords: [d.latitude, d.longitude], ids: []};
                                    }

                                    collection.ids.push(d.store_id);
                                    grouped[key] = collection;
                                }
                            }


                            var mymap = L.map('mapid').setView([38.3, -3.5], 4);
                            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                            }).addTo(mymap);

                            for (let k in grouped) {
                                let d = grouped[k];
                                let icon = d.ids.length === 1 ? markerIcons[Math.floor(Math.random() * 4)] : multiMarkerIcon;
                                let marker = L.marker(d.coords, {icon: icon}).addTo(mymap);

                                let idHtml = "<b>" + d.ids.length + " store" + (d.ids.length === 1 ? "" : "s") + "</b>"

                                for (let id of d.ids) {
                                    idHtml += "<br>" + id;
                                }

                                marker.bindPopup(idHtml);
                            }
                        }
                   })
                </script>
                <div class="card-header" style="padding-bottom: 10px">Map</div>
            </div>
        </div>

        <div class="modal" id="test-modal">
            <div class="card card-error">
                <div class="card-header">I'm a big and important modal</div>
                <div class="card-content">
                    This is a big warning modal that wants you to be sure you have seen my information.
                </div>
                <div class="card-content align-right">
                    <button class="btn-primary" onclick="app.hideModal(this)">Close</button>
                </div>
            </div>
        </div>

        <div class="snackbar-container">
        </div>
    </body>
</html>
