"use strict";function _typeof(r){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(r){return typeof r}:function(r){return r&&"function"==typeof Symbol&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r})(r)}function _classCallCheck(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function _createClass(r,e,t){return e&&_defineProperties(r.prototype,e),t&&_defineProperties(r,t),r}!function(){var g={invalid_argument_format:"Argument name may not begin with '-$'",invalid_value:function(r){return"Invalid value '-".concat(r,"'")},unknown_command:function(r){return"Unknown command '".concat(r,"'")},unknown_argument:function(r){return"Invalid argument '-".concat(r,"'")},unknown_main_argument:"No main parameters allowed",mismatched_param_count:function(r,e,t){return"$main"===r?"Mismatched parameters for command, expected ".concat(e,", found ").concat(t):"Mismatched parameters for '-".concat(r,"', expected ").concat(e,", found ").concat(t)},double_argument:function(r){return"Double argument '-".concat(r,"'")},nan:function(r){return"Not a number '".concat(r,"'")}},c=function(){function e(r){_classCallCheck(this,e),this.tokens=r,this.pos=0}return _createClass(e,[{key:"hasNext",value:function(){return this.pos<this.tokens.length}},{key:"read",value:function(){return this.tokens[this.pos++]}},{key:"peek",value:function(){return this.tokens[this.pos]}},{key:"reset",value:function(){this.pos=0}},{key:"renderHighlighted",value:function(){var r=document.createElement("span"),e=!0,t=!(r.className="highlighted-command"),n=void 0;try{for(var a,s=this.tokens[Symbol.iterator]();!(e=(a=s.next()).done);e=!0){var i=a.value,u=document.createElement("span"),o=!0,l=!1,c=void 0;try{for(var h,f=i.types[Symbol.iterator]();!(o=(h=f.next()).done);o=!0){var m=h.value;u.className+=" highlight-"+m}}catch(r){l=!0,c=r}finally{try{o||null==f.return||f.return()}finally{if(l)throw c}}0<i.errors.length&&(u.className+=" highlight-error"),u.innerText=i.rawText,r.appendChild(u)}}catch(r){t=!0,n=r}finally{try{e||null==s.return||s.return()}finally{if(t)throw n}}return r}}]),e}();function h(e){return function(r){return e.includes(r)?{match:!0,value:r}:{match:!1,error:g.invalid_value(r)}}}function f(o){return function(r){var e=[],t=!0,n=!1,a=void 0;try{for(var s,i=o[Symbol.iterator]();!(t=(s=i.next()).done);t=!0){var u=s.value;u.length>=r.length&&u.substring(0,r.length)===r&&e.push(u)}}catch(r){n=!0,a=r}finally{try{t||null==i.return||i.return()}finally{if(n)throw a}}return e}}var m=function(){function l(r){_classCallCheck(this,l),this.name=r.name,this.params=[],this.required=r.required||!1,this.multi=r.multi||!1;var e=r.params||(r.param?[r.param]:[]),t=!0,n=!1,a=void 0;try{for(var s,i=e[Symbol.iterator]();!(t=(s=i.next()).done);t=!0){var u=s.value;if(Array.isArray(u))this.params.push({parser:h(u),suggestor:f(u)});else if(Array.isArray(u.literals))this.params.push({parser:h(u.literals),suggestor:f(u.literals)});else{if("function"!=typeof u.parser)throw new Error("Parameter for argument '".concat(this.name,"' has no parser function"));var o=u.suggestor;"function"!=typeof o&&(o=function(){return[]}),this.params.push({parser:u.parser,suggestor:o})}}}catch(r){n=!0,a=r}finally{try{t||null==i.return||i.return()}finally{if(n)throw a}}}return _createClass(l,[{key:"parse",value:function(r,e){if(r.values.length!==this.params.length)return e(g.mismatched_param_count(r.name,this.params.length,r.values.length),r.token),{error:!0};for(var t=[],n=0,a=this.params.length;n<a;n++){var s=r.values[n],i=this.params[n].parser(s.text);if(!i.match)return e(i.error,s),{error:!0};t.push(i.value)}return{error:!1,result:t}}}]),l}(),o=function(){function h(r){_classCallCheck(this,h);var e=r.aliases||(r.alias?[r.alias]:[]),t=r.args||[];if(0===e.length)throw new ReferenceError("Command with no aliases");this.aliases=e,this.args=[],this.requiredArgs=[],this.argsByName={},"function"==typeof r.trigger&&(this.trigger=r.trigger);var n,a=!0,s=!1,i=void 0;try{for(var u,o=t[Symbol.iterator]();!(a=(u=o.next()).done);a=!0){var l=u.value,c=new m(l);this.args.push(c),"$main"!==(this.argsByName[c.name]=c).name&&this.requiredArgs.push(c.name)}}catch(r){s=!0,i=r}finally{try{a||null==o.return||o.return()}finally{if(s)throw i}}this.argsByName.$main||(n=new m({name:"$main"}),this.args.push(n),this.argsByName.$main=n)}return _createClass(h,[{key:"trigger",value:function(){}},{key:"match",value:function(r){if(!this.aliases.includes(r.command))return{match:!1};var t=[],e={},n=this.requiredArgs.slice();function a(r,e){t.push(r),e.errors.push(r)}var s=!0,i=!1,u=void 0;try{for(var o,l=r.foundArgs[Symbol.iterator]();!(s=(o=l.next()).done);s=!0){var c=o.value;if(c.main||"$"!==c.name[0]){var h=this.argsByName[c.name];if(h){var f=h.parse(c,a);if(!f.error){var m=e[c.name]||{};if(Array.isArray(m.values)&&0!==m.values.length){if(!h.multi){a(g.double_argument(c.name),c.token);continue}m.values.push(f.result)}else m.values=[f.result];e[c.name]=m;for(var v=0;v<n.length;v++)n[v]===c.name&&(n.splice(v,1),v--)}}else a(g.unknown_argument(c.name),c.token)}else a(g.invalid_argument_format,c.token)}}catch(r){i=!0,u=r}finally{try{s||null==l.return||l.return()}finally{if(i)throw u}}return n.length,{match:!0,errors:t,argData:e}}}]),h}();var v=function(){function e(r){_classCallCheck(this,e),this.argData=r}return _createClass(e,[{key:"has",value:function(r){return r in this.argData}},{key:"value",value:function(r,e){var t=1<arguments.length&&void 0!==e?e:0;if(r in this.argData)return this.argData[r].values[0][t]}},{key:"values",value:function(r){if(r in this.argData)return this.argData[r].values[0]}},{key:"multiValue",value:function(r,e){var t=1<arguments.length&&void 0!==e?e:0;if(r in this.argData){var n=[],a=!0,s=!1,i=void 0;try{for(var u,o=this.argData[r].values[Symbol.iterator]();!(a=(u=o.next()).done);a=!0){var l=u.value;n.push(l[t])}}catch(r){s=!0,i=r}finally{try{a||null==o.return||o.return()}finally{if(s)throw i}}return n}}},{key:"multiValues",value:function(r){if(r in this.argData)return this.argData[r].values}}]),e}(),r=function(){function u(r){_classCallCheck(this,u);var e=!0,t=!(this.commands=[]),n=void 0;try{for(var a,s=r[Symbol.iterator]();!(e=(a=s.next()).done);e=!0){var i=a.value;this.commands.push(new o(i))}}catch(r){t=!0,n=r}finally{try{e||null==s.return||s.return()}finally{if(t)throw n}}}return _createClass(u,[{key:"parse",value:function(t){var r=function(r){for(var e=[],t=0,n=r.length,a=-1,s=0,i=null;t<n;){var u=r[t];i?u===i&&(e.push({text:r.substring(a,t),rawText:r.substring(s,t+1),start:a,end:t,type:["raw"],errors:[]}),a=-1,s=t+1,i=null):" "===u?0<=a&&(e.push({text:r.substring(a,t),rawText:r.substring(s,t),start:a,end:t,type:["raw"],errors:[]}),a=-1,s=t):"'"===u||'"'===u?(i=u,a=t+1):a<0&&(a=t),t++}return 0<=a&&e.push({text:r.substring(a,t),start:a,end:t,type:["raw"],errors:[]}),e}(t);if(0===r.length)return{errors:[g.unknown_command("")],text:t,execute:function(){throw new Error("Cannot execute command as parse errors are present")}};var n=new c(r),a=function(r){var e=r.read();e.type=["command"];for(var t=[],n={main:!0,token:e,name:"$main",values:[]};r.hasNext();){var a,s=r.read();"-"===s.text[0]?(s.type=["argument"],n&&t.push(n),a=s.text.substring(1),n={main:!1,token:s,name:a,values:[]}):(s.type=["value"],s.type.push("argv"),n.values.push(s))}return t.push(n),{command:e.text,firstToken:e,foundArgs:t}}(n),e=!0,s=!1,i=void 0;try{for(var u,o=this.commands[Symbol.iterator]();!(e=(u=o.next()).done);e=!0){var l=function(){var r=u.value,e=r.match(a);if(e.match)return{v:{text:t,errors:e.errors,argData:e.argData,result:new v(e.argData),command:r,execute:function(){if(0<this.errors.length)throw new Error("Cannot execute command as parse errors are present");return r.trigger(this.result)},renderHighlighted:function(){return n.renderHighlighted()}}}}();if("object"===_typeof(l))return l.v}}catch(r){s=!0,i=r}finally{try{e||null==o.return||o.return()}finally{if(s)throw i}}return{errors:[g.unknown_command(a.command)],text:t,execute:function(){throw new Error("Cannot execute command as parse errors are present")}}}}]),u}();window.CommandDispatcher=r,window.ArgTypes={string:{parser:function(r){return{match:!0,value:r}},suggestor:function(){return[]}},int:{parser:function(r){var e=parseInt(r);return isNaN(e)?{match:!1,error:g.nan(r)}:{match:!0,value:e}},suggestor:function(){return[]}},float:{parser:function(r){var e=parseFloat(r);return isNaN(e)?{match:!1,error:g.nan(r)}:{match:!0,value:e}},suggestor:function(){return[]}},boolean:{parser:h(["true","false"]),suggestor:f(["true","false"])}}}();